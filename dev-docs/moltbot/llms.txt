# Moltbot

Moltbot is a personal AI assistant that runs on your own devices, integrating with messaging platforms including WhatsApp, Telegram, Slack, Discord, Google Chat, Signal, iMessage, Microsoft Teams, Matrix, and WebChat. It provides a local-first Gateway control plane for managing sessions, channels, tools, and events, with support for multi-agent routing to isolated workspaces. The assistant supports voice interactions via Voice Wake and Talk Mode on macOS/iOS/Android, and can render live Canvas surfaces for agent-driven visual workspaces.

The core architecture centers around a WebSocket-based Gateway server that acts as the control plane, orchestrating communication between messaging channels, AI agent backends (Anthropic Claude, OpenAI, etc.), and client applications (CLI, macOS menu bar app, iOS/Android nodes). The system supports flexible authentication via OAuth tokens or API keys, with model failover capabilities across multiple providers. Skills extend the assistant's capabilities through workspace-installed modules, and the plugin SDK enables custom channel and service integrations.

## CLI Commands

### Installation and Setup

The primary entry point for new users. The `onboard` command walks through gateway, workspace, channels, and skills configuration with an interactive wizard.

```bash
# Interactive onboarding (recommended)
moltbot onboard --install-daemon

# Non-interactive onboarding with API key
moltbot onboard --non-interactive --accept-risk \
  --auth-choice api-key \
  --anthropic-api-key "sk-ant-..." \
  --model "anthropic/claude-sonnet-4-20250514"

# Reset configuration and start fresh
moltbot onboard --reset
```

### Gateway Server

Start the local Gateway server that manages all channel connections and agent sessions.

```bash
# Start gateway on default port (18789)
moltbot gateway --port 18789 --verbose

# Start with forced port (kill existing process if needed)
moltbot gateway --force

# Start in development mode (skips channels)
CLAWDBOT_SKIP_CHANNELS=1 moltbot gateway --dev
```

### Agent Command

Send messages to the AI agent and receive responses. Supports session management, thinking levels, and delivery to connected channels.

```bash
# Basic agent interaction
moltbot agent --message "What is the weather today?" --to "+1234567890"

# With session and thinking level
moltbot agent --message "Analyze this code" \
  --session-key "main" \
  --thinking high \
  --timeout 300

# Send to specific agent
moltbot agent --message "Help me plan" --agent my-work-agent

# Deliver response back to WhatsApp
moltbot agent --message "Summarize today" \
  --to "+1234567890" \
  --deliver
```

### Message Send

Send messages directly through connected channels without invoking the agent.

```bash
# Send via WhatsApp (default channel)
moltbot message send --to "+1234567890" --message "Hello!"

# Send with media attachment
moltbot message send --to "+1234567890" \
  --message "Check this out" \
  --media-url "https://example.com/image.png"

# Send via specific channel
moltbot message send --to "user@example.com" \
  --message "Meeting in 5 minutes" \
  --channel telegram
```

### Health and Status

Check gateway health, channel status, and session information.

```bash
# Quick health check
moltbot health --json

# Detailed status with usage info
moltbot status --deep --usage

# List all active sessions
moltbot sessions --json

# List configured agents
moltbot agents list --bindings
```

### Doctor and Diagnostics

Diagnose configuration issues and run migrations.

```bash
# Run full diagnostic
moltbot doctor

# Run with automatic fixes
moltbot doctor --yes

# Check specific components
moltbot doctor --workspace --config --daemon
```

## Gateway WebSocket API

### Connection and Authentication

Connect to the Gateway WebSocket with authentication token.

```javascript
// Connect to Gateway
const ws = new WebSocket('ws://127.0.0.1:18789');

// Authenticate on connection
ws.onopen = () => {
  ws.send(JSON.stringify({
    id: 1,
    method: 'connect',
    params: {
      role: 'operator',
      token: 'your-gateway-token',
      scopes: ['operator.admin']
    }
  }));
};

// Handle responses and events
ws.onmessage = (event) => {
  const frame = JSON.parse(event.data);
  if (frame.id) {
    // Response to request
    console.log('Response:', frame.result || frame.error);
  } else if (frame.event) {
    // Server-pushed event
    console.log('Event:', frame.event, frame.payload);
  }
};
```

### Send Message via Gateway

Send messages through connected channels via WebSocket.

```javascript
// Send a message
ws.send(JSON.stringify({
  id: 2,
  method: 'send',
  params: {
    to: '+1234567890',
    message: 'Hello from Gateway!',
    channel: 'whatsapp',
    idempotencyKey: crypto.randomUUID()
  }
}));

// Response
// { "id": 2, "ok": true, "result": { "messageId": "msg_123" } }
```

### Invoke Agent via Gateway

Run agent interactions through the Gateway.

```javascript
// Invoke agent
ws.send(JSON.stringify({
  id: 3,
  method: 'agent',
  params: {
    message: 'What time is it in Tokyo?',
    sessionKey: 'main',
    thinking: 'medium',
    deliver: true,
    idempotencyKey: crypto.randomUUID()
  }
}));

// Stream events received via 'agent' event frames
// { "event": "agent", "payload": { "type": "delta", "content": "The current..." } }
// { "event": "agent", "payload": { "type": "done", "response": "..." } }
```

### Session Management

List, patch, reset, and delete sessions.

```javascript
// List sessions
ws.send(JSON.stringify({
  id: 4,
  method: 'sessions.list',
  params: {}
}));

// Response: { "id": 4, "ok": true, "result": { "sessions": [...] } }

// Patch session settings
ws.send(JSON.stringify({
  id: 5,
  method: 'sessions.patch',
  params: {
    sessionKey: 'whatsapp:+1234567890',
    thinking: 'high',
    model: 'anthropic/claude-opus-4-5'
  }
}));

// Reset a session (clear conversation history)
ws.send(JSON.stringify({
  id: 6,
  method: 'sessions.reset',
  params: { sessionKey: 'main' }
}));
```

### Cron Jobs

Schedule automated tasks via the Gateway.

```javascript
// Add a cron job
ws.send(JSON.stringify({
  id: 7,
  method: 'cron.add',
  params: {
    id: 'daily-summary',
    schedule: '0 9 * * *',  // 9 AM daily
    agentId: 'default',
    message: 'Give me a summary of my calendar for today',
    sessionKey: 'cron:daily',
    deliver: true,
    channel: 'telegram'
  }
}));

// List cron jobs
ws.send(JSON.stringify({
  id: 8,
  method: 'cron.list',
  params: {}
}));

// Manually trigger a cron job
ws.send(JSON.stringify({
  id: 9,
  method: 'cron.run',
  params: { id: 'daily-summary' }
}));
```

### Node Management

Manage connected device nodes (macOS, iOS, Android).

```javascript
// List connected nodes
ws.send(JSON.stringify({
  id: 10,
  method: 'node.list',
  params: {}
}));

// Invoke a node action
ws.send(JSON.stringify({
  id: 11,
  method: 'node.invoke',
  params: {
    nodeId: 'macbook-pro',
    action: 'camera.snap',
    args: { camera: 'front' }
  }
}));
```

### Health and Models

Query system health and available models.

```javascript
// Get health status
ws.send(JSON.stringify({
  id: 12,
  method: 'health',
  params: {}
}));

// List available models
ws.send(JSON.stringify({
  id: 13,
  method: 'models.list',
  params: {}
}));

// Get channel status
ws.send(JSON.stringify({
  id: 14,
  method: 'channels.status',
  params: {}
}));
```

## Configuration

### Configuration File Structure

The main configuration file at `~/.clawdbot/moltbot.json` defines all settings.

```json5
{
  // Agent configuration
  agent: {
    model: "anthropic/claude-opus-4-5",
    timeoutSeconds: 300
  },

  // Multi-agent setup
  agents: {
    defaults: {
      workspace: "~/clawd",
      skipBootstrap: false,
      sandbox: {
        mode: "non-main"  // Sandbox non-main sessions
      }
    },
    // Named agents
    "work-agent": {
      workspace: "~/work-clawd",
      model: "anthropic/claude-sonnet-4-20250514"
    }
  },

  // Gateway settings
  gateway: {
    port: 18789,
    bind: "loopback",  // loopback, lan, tailnet, auto
    auth: {
      mode: "token",
      token: "your-secure-token"
    },
    tailscale: {
      mode: "serve"  // off, serve, funnel
    }
  },

  // Channel configurations
  channels: {
    whatsapp: {
      enabled: true,
      allowFrom: ["+1234567890"],
      groups: {
        "*": { requireMention: true }
      }
    },
    telegram: {
      enabled: true,
      botToken: "${TELEGRAM_BOT_TOKEN}"
    },
    discord: {
      enabled: true,
      token: "${DISCORD_BOT_TOKEN}"
    },
    slack: {
      enabled: true,
      botToken: "${SLACK_BOT_TOKEN}",
      appToken: "${SLACK_APP_TOKEN}"
    }
  },

  // Model providers
  providers: {
    anthropic: {
      apiKey: "${ANTHROPIC_API_KEY}"
    },
    openai: {
      apiKey: "${OPENAI_API_KEY}"
    }
  },

  // Tools configuration
  tools: {
    browser: {
      enabled: true
    },
    exec: {
      safeBins: ["git", "npm", "node"]
    }
  },

  // TTS settings
  tts: {
    enabled: true,
    provider: "elevenlabs",
    voiceId: "your-voice-id"
  }
}
```

### Environment Variables

Override configuration via environment variables.

```bash
# API Keys
export ANTHROPIC_API_KEY="sk-ant-..."
export OPENAI_API_KEY="sk-..."
export TELEGRAM_BOT_TOKEN="123456:ABC..."
export DISCORD_BOT_TOKEN="..."
export SLACK_BOT_TOKEN="xoxb-..."
export SLACK_APP_TOKEN="xapp-..."

# Gateway configuration
export CLAWDBOT_GATEWAY_PORT="18789"
export CLAWDBOT_CONFIG_PATH="~/.clawdbot/moltbot.json"

# Debug options
export CLAWDBOT_DEBUG="1"
export CLAWDBOT_RAW_STREAM="1"
```

## Channel Integrations

### WhatsApp Setup

Link WhatsApp via QR code scan using Baileys web protocol.

```bash
# Login to WhatsApp (generates QR code)
moltbot channels login whatsapp

# Check WhatsApp status
moltbot channels status --channel whatsapp

# Logout from WhatsApp
moltbot channels logout whatsapp
```

### Telegram Bot Setup

Configure a Telegram bot with grammY framework.

```bash
# Set bot token in config or environment
export TELEGRAM_BOT_TOKEN="123456:ABC-DEF..."

# Add to moltbot.json
{
  "channels": {
    "telegram": {
      "enabled": true,
      "botToken": "${TELEGRAM_BOT_TOKEN}",
      "allowFrom": ["@yourusername"],
      "groups": {
        "*": { "requireMention": true }
      }
    }
  }
}

# Start gateway to connect
moltbot gateway
```

### Discord Bot Setup

Configure a Discord bot with discord.js.

```bash
# Set bot token
export DISCORD_BOT_TOKEN="..."

# Configuration
{
  "channels": {
    "discord": {
      "enabled": true,
      "token": "${DISCORD_BOT_TOKEN}",
      "dm": {
        "policy": "pairing",
        "allowFrom": ["user-id-1", "user-id-2"]
      },
      "guilds": {
        "guild-id": {
          "channels": ["channel-id-1"],
          "requireMention": true
        }
      }
    }
  }
}
```

### Slack App Setup

Configure Slack with Bolt framework (requires Socket Mode).

```bash
# Set tokens
export SLACK_BOT_TOKEN="xoxb-..."
export SLACK_APP_TOKEN="xapp-..."

# Configuration
{
  "channels": {
    "slack": {
      "enabled": true,
      "botToken": "${SLACK_BOT_TOKEN}",
      "appToken": "${SLACK_APP_TOKEN}",
      "dm": {
        "policy": "open",
        "allowFrom": ["*"]
      }
    }
  }
}
```

## Skills System

### Workspace Skills

Skills extend agent capabilities via SKILL.md files in the workspace.

```bash
# Skill directory structure
~/clawd/skills/
├── my-skill/
│   ├── SKILL.md           # Skill prompt and instructions
│   ├── package.json       # Dependencies (optional)
│   └── tools/             # Custom tool scripts (optional)

# Install a skill from registry
moltbot skills install github-skill

# List installed skills
moltbot skills status --json

# Update all skills
moltbot skills update --all
```

### SKILL.md Format

Define a custom skill with markdown instructions.

```markdown
# My Custom Skill

## Description
This skill helps with project management tasks.

## Commands
- `/project list` - List all projects
- `/project create <name>` - Create a new project

## Instructions
When the user asks about projects, use the project management API.
Always confirm before making destructive changes.

## Tools
You have access to the following tools:
- `project_list`: List all projects
- `project_create`: Create a new project with the given name
- `project_delete`: Delete a project (requires confirmation)
```

## Plugin SDK

### Creating a Channel Plugin

Extend Moltbot with custom channel integrations.

```typescript
import type {
  ChannelPlugin,
  ChannelConfigSchema,
  ChannelOutboundContext,
  MoltbotConfig
} from 'moltbot/plugin-sdk';

// Define configuration schema
const configSchema: ChannelConfigSchema = {
  type: 'object',
  properties: {
    enabled: { type: 'boolean', default: false },
    apiKey: { type: 'string' },
    webhookUrl: { type: 'string' }
  },
  required: ['apiKey']
};

// Create the plugin
export const myChannelPlugin: ChannelPlugin = {
  id: 'mychannel',
  displayName: 'My Custom Channel',
  configSchema,

  // Initialize channel connection
  async start({ cfg, log }) {
    const config = cfg.channels?.mychannel;
    if (!config?.enabled) return { ok: false, reason: 'disabled' };

    log.info('Starting My Channel integration');
    // Initialize connection...
    return { ok: true };
  },

  // Send outbound messages
  outbound: {
    async send(ctx: ChannelOutboundContext) {
      const { to, message, mediaUrls } = ctx;
      // Send message via your channel API
      const response = await fetch('https://api.mychannel.com/send', {
        method: 'POST',
        headers: { 'Authorization': `Bearer ${ctx.config.apiKey}` },
        body: JSON.stringify({ to, message, media: mediaUrls })
      });
      return { ok: response.ok, messageId: (await response.json()).id };
    }
  },

  // Handle incoming messages
  async onMessage({ from, message, reply }) {
    // Process incoming message
    // Call reply() to send agent response
  }
};
```

### Creating a Gateway Method Plugin

Add custom Gateway WebSocket methods.

```typescript
import type {
  GatewayRequestHandler,
  MoltbotPluginApi
} from 'moltbot/plugin-sdk';

export const myPlugin: MoltbotPluginApi = {
  id: 'my-plugin',

  // Register Gateway methods
  gatewayMethods: ['my.custom.method', 'my.other.method'],

  gatewayHandlers: {
    'my.custom.method': async ({ params, respond, context }) => {
      const { inputData } = params as { inputData: string };

      // Process the request
      const result = await processData(inputData);

      // Send response
      respond(true, { result });
    },

    'my.other.method': async ({ params, respond }) => {
      // Another method implementation
      respond(true, { status: 'ok' });
    }
  }
};

// Register with plugin system
export default myPlugin;
```

## Chat Commands

### In-Chat Commands

Send commands directly in messaging channels (WhatsApp, Telegram, Slack, etc.).

```
# Session management
/status          - Show session status (model, tokens, cost)
/new             - Reset the session (clear history)
/reset           - Same as /new
/compact         - Compact session context (summarize history)

# Thinking and verbosity
/think high      - Set thinking level (off|minimal|low|medium|high|xhigh)
/verbose on      - Enable verbose output
/verbose off     - Disable verbose output
/usage full      - Show full usage stats per response

# Group settings (owner-only in groups)
/activation mention   - Require @mention to activate in groups
/activation always    - Always respond in groups
/restart              - Restart the gateway

# TTS (text-to-speech)
/tts on          - Enable voice responses
/tts off         - Disable voice responses
```

## Summary

Moltbot serves as a comprehensive personal AI assistant infrastructure, primarily designed for individuals who want a self-hosted, privacy-conscious AI that integrates deeply with their existing communication channels. The main use cases include: automated message handling across multiple platforms, voice-activated assistance on mobile and desktop, scheduled tasks via cron jobs, custom tool integrations through skills, and multi-agent workflows with isolated sessions. The Gateway acts as the central hub, enabling any WebSocket-capable client to interact with the full system.

Integration patterns typically involve either using the CLI for quick interactions and scripting (`moltbot agent --message "..." --deliver`), connecting to the Gateway WebSocket for real-time bidirectional communication, or building custom plugins via the Plugin SDK. The configuration system supports environment variable substitution, making it easy to manage secrets across deployments. For production use, the recommended setup involves running the Gateway as a daemon (via launchd/systemd), optionally exposing it via Tailscale Serve/Funnel for remote access, and configuring appropriate security policies including DM pairing codes and sandbox modes for non-main sessions.
