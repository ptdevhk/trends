# OpenCode

OpenCode is an open-source AI-powered coding agent that runs in the terminal or as a desktop application. It provides a type-safe JavaScript/TypeScript SDK for programmatic control and supports multiple AI providers including Anthropic, OpenAI, Google, and local models. The core architecture follows a client/server model where the server exposes an OpenAPI 3.1 specification, allowing the TUI, web interface, desktop app, and custom integrations to interact with the same backend.

The project features built-in agents (Build for full development work, Plan for read-only analysis), MCP (Model Context Protocol) server support, LSP integration for code intelligence, and extensive customization through JSON configuration files. OpenCode can be extended with custom agents, commands, plugins, and tools, making it adaptable to various development workflows.

---

## Installation

Install OpenCode using your preferred package manager.

```bash
# Quick install via curl
curl -fsSL https://opencode.ai/install | bash

# npm/bun/pnpm/yarn
npm i -g opencode-ai@latest

# Homebrew (macOS/Linux)
brew install anomalyco/tap/opencode

# Windows
scoop install opencode
# or
choco install opencode
```

---

## SDK Installation

Install the TypeScript SDK for programmatic access.

```bash
npm install @opencode-ai/sdk
```

---

## createOpencode - Start Server and Client

Creates both an OpenCode server instance and a connected client for programmatic control. This is the recommended way to integrate OpenCode into applications.

```typescript
import { createOpencode } from "@opencode-ai/sdk"

// Start server with default settings (localhost:4096)
const { client, server } = await createOpencode()

// Create a session and send a prompt
const session = await client.session.create({
  body: { title: "Code Review Session" }
})

const response = await client.session.prompt({
  path: { id: session.data.id },
  body: {
    model: { providerID: "anthropic", modelID: "claude-sonnet-4-20250514" },
    parts: [{ type: "text", text: "Analyze the error handling in this codebase" }]
  }
})

console.log("Response:", response.data)

// Clean up
server.close()
```

---

## createOpencode with Configuration

Start the server with custom configuration options including model selection, timeout, and inline config.

```typescript
import { createOpencode } from "@opencode-ai/sdk"

const { client, server } = await createOpencode({
  hostname: "127.0.0.1",
  port: 8080,
  timeout: 10000, // 10 second startup timeout
  config: {
    model: "anthropic/claude-sonnet-4-20250514",
    small_model: "anthropic/claude-haiku-4-20250514",
    theme: "opencode",
    permission: {
      edit: "allow",
      bash: "ask"
    }
  }
})

console.log(`OpenCode server running at ${server.url}`)

// Use the client...
const sessions = await client.session.list()
console.log(`Found ${sessions.data.length} existing sessions`)

server.close()
```

---

## createOpencodeClient - Connect to Existing Server

Creates a client instance that connects to an already running OpenCode server. Use this when the server is started separately or running remotely.

```typescript
import { createOpencodeClient } from "@opencode-ai/sdk"

// Connect to a running server
const client = createOpencodeClient({
  baseUrl: "http://localhost:4096"
})

// List all sessions
const sessions = await client.session.list()
console.log("Sessions:", sessions.data)

// Get current project info
const project = await client.project.current()
console.log("Project:", project.data.worktree)

// Get VCS (Git) information
const vcs = await client.vcs.get()
console.log("Branch:", vcs.data.branch)
```

---

## Session Management

Create, list, and manage coding sessions. Sessions track conversations and file changes.

```typescript
import { createOpencodeClient } from "@opencode-ai/sdk"

const client = createOpencodeClient({ baseUrl: "http://localhost:4096" })

// Create a new session
const session = await client.session.create({
  body: { title: "Implement User Authentication" }
})
console.log("Created session:", session.data.id)

// List all sessions
const allSessions = await client.session.list()
for (const s of allSessions.data) {
  console.log(`- ${s.title} (${s.id})`)
}

// Get session status (idle, busy, retry)
const status = await client.session.status()
console.log("Session statuses:", status.data)

// Update session title
const updated = await client.session.update({
  path: { id: session.data.id },
  body: { title: "Implement OAuth2 Authentication" }
})

// Get file diffs from session
const diffs = await client.session.diff({
  path: { id: session.data.id }
})
for (const diff of diffs.data) {
  console.log(`${diff.file}: +${diff.additions} -${diff.deletions}`)
}

// Fork a session at a specific message
const forked = await client.session.fork({
  path: { id: session.data.id },
  body: { messageID: "msg_abc123" }
})

// Delete a session
await client.session.delete({ path: { id: session.data.id } })
```

---

## Sending Prompts

Send messages to sessions and receive AI responses. Supports text, files, and structured output.

```typescript
import { createOpencodeClient } from "@opencode-ai/sdk"

const client = createOpencodeClient({ baseUrl: "http://localhost:4096" })

// Create session
const session = await client.session.create({ body: { title: "Development" } })

// Send a basic text prompt
const response = await client.session.prompt({
  path: { id: session.data.id },
  body: {
    model: { providerID: "anthropic", modelID: "claude-sonnet-4-20250514" },
    parts: [{ type: "text", text: "Refactor the authentication module to use JWT tokens" }]
  }
})

console.log("Assistant response:", response.data.info)
console.log("Parts:", response.data.parts)

// Inject context without AI response (useful for plugins)
await client.session.prompt({
  path: { id: session.data.id },
  body: {
    noReply: true,
    parts: [{ type: "text", text: "Project uses TypeScript 5.0 with strict mode enabled." }]
  }
})

// Send with file attachment
await client.session.prompt({
  path: { id: session.data.id },
  body: {
    parts: [
      { type: "text", text: "Review this code for security issues" },
      { type: "file", mime: "text/typescript", url: "file:///src/auth.ts" }
    ]
  }
})

// Async prompt (fire and forget, returns immediately)
await client.session.promptAsync({
  path: { id: session.data.id },
  body: {
    parts: [{ type: "text", text: "Generate unit tests for the utils module" }]
  }
})
```

---

## Structured Output

Request validated JSON responses matching a specific schema.

```typescript
import { createOpencodeClient } from "@opencode-ai/sdk"

const client = createOpencodeClient({ baseUrl: "http://localhost:4096" })
const session = await client.session.create({ body: {} })

// Request structured JSON output
const result = await client.session.prompt({
  path: { id: session.data.id },
  body: {
    parts: [{ type: "text", text: "Analyze the API structure and list all endpoints" }],
    format: {
      type: "json_schema",
      schema: {
        type: "object",
        properties: {
          endpoints: {
            type: "array",
            items: {
              type: "object",
              properties: {
                method: { type: "string", description: "HTTP method (GET, POST, etc.)" },
                path: { type: "string", description: "URL path" },
                description: { type: "string", description: "What the endpoint does" }
              },
              required: ["method", "path"]
            }
          },
          totalCount: { type: "number", description: "Total number of endpoints" }
        },
        required: ["endpoints", "totalCount"]
      },
      retryCount: 3 // Retry up to 3 times if validation fails
    }
  }
})

// Access structured output
const output = result.data.info.structured_output
console.log(`Found ${output.totalCount} endpoints:`)
for (const ep of output.endpoints) {
  console.log(`  ${ep.method} ${ep.path} - ${ep.description}`)
}
```

---

## File Operations

Search files, read content, and find symbols using LSP integration.

```typescript
import { createOpencodeClient } from "@opencode-ai/sdk"

const client = createOpencodeClient({ baseUrl: "http://localhost:4096" })

// Search for text in files (regex supported)
const textMatches = await client.find.text({
  query: { pattern: "async function.*Handler" }
})
for (const match of textMatches.data) {
  console.log(`${match.path.text}:${match.line_number} - ${match.lines.text}`)
}

// Find files by name pattern
const tsFiles = await client.find.files({
  query: { query: "*.test.ts", type: "file", limit: 20 }
})
console.log("Test files:", tsFiles.data)

// Find directories
const dirs = await client.find.files({
  query: { query: "components", type: "directory" }
})

// Read file content
const content = await client.file.read({
  query: { path: "src/index.ts" }
})
console.log("File type:", content.data.type) // "text" or "binary"
console.log("Content:", content.data.content)

// Get git status for tracked files
const fileStatus = await client.file.status()
for (const file of fileStatus.data) {
  console.log(`${file.status}: ${file.path} (+${file.added}/-${file.removed})`)
}

// Find workspace symbols (requires LSP)
const symbols = await client.find.symbols({
  query: { query: "AuthService" }
})
for (const sym of symbols.data) {
  console.log(`${sym.name} (${sym.kind}) at ${sym.location.uri}`)
}
```

---

## Event Subscription

Subscribe to real-time server events using Server-Sent Events (SSE).

```typescript
import { createOpencodeClient } from "@opencode-ai/sdk"

const client = createOpencodeClient({ baseUrl: "http://localhost:4096" })

// Subscribe to events
const events = await client.event.subscribe()

for await (const event of events.stream) {
  switch (event.type) {
    case "session.created":
      console.log("New session:", event.properties.info.title)
      break
    case "session.status":
      console.log(`Session ${event.properties.sessionID}: ${event.properties.status.type}`)
      break
    case "message.updated":
      console.log("Message updated:", event.properties.info.id)
      break
    case "message.part.updated":
      if (event.properties.part.type === "text") {
        process.stdout.write(event.properties.delta || "")
      }
      break
    case "permission.updated":
      console.log("Permission requested:", event.properties.title)
      break
    case "file.edited":
      console.log("File changed:", event.properties.file)
      break
    case "todo.updated":
      console.log("Todos:", event.properties.todos)
      break
    default:
      console.log("Event:", event.type)
  }
}
```

---

## Provider and Authentication

Manage AI providers and authentication credentials.

```typescript
import { createOpencodeClient } from "@opencode-ai/sdk"

const client = createOpencodeClient({ baseUrl: "http://localhost:4096" })

// List all providers with their models
const providers = await client.provider.list()
console.log("Connected providers:", providers.data.connected)
console.log("Default models:", providers.data.default)

for (const provider of providers.data.all) {
  console.log(`\n${provider.name} (${provider.id}):`)
  for (const [modelId, model] of Object.entries(provider.models)) {
    console.log(`  - ${model.name} (${modelId})`)
  }
}

// Get authentication methods for providers
const authMethods = await client.provider.auth()
for (const [providerId, methods] of Object.entries(authMethods.data)) {
  console.log(`${providerId}:`, methods.map(m => m.label).join(", "))
}

// Set API key authentication
await client.auth.set({
  path: { id: "anthropic" },
  body: { type: "api", key: "sk-ant-..." }
})

// Set OAuth authentication
await client.auth.set({
  path: { id: "github-copilot" },
  body: {
    type: "oauth",
    access: "gho_...",
    refresh: "ghr_...",
    expires: Date.now() + 3600000
  }
})
```

---

## Agent Management

List and use specialized AI agents with different capabilities.

```typescript
import { createOpencodeClient } from "@opencode-ai/sdk"

const client = createOpencodeClient({ baseUrl: "http://localhost:4096" })

// List all available agents
const agents = await client.app.agents()

for (const agent of agents.data) {
  console.log(`\n${agent.name} (${agent.mode}):`)
  console.log(`  Description: ${agent.description}`)
  console.log(`  Built-in: ${agent.builtIn}`)
  console.log(`  Color: ${agent.color}`)
  if (agent.model) {
    console.log(`  Model: ${agent.model.providerID}/${agent.model.modelID}`)
  }
  console.log(`  Permissions:`, agent.permission)
  console.log(`  Tools:`, Object.keys(agent.tools).filter(t => agent.tools[t]))
}

// Use a specific agent in a session
const session = await client.session.create({ body: {} })

// Use the plan agent (read-only analysis)
await client.session.prompt({
  path: { id: session.data.id },
  body: {
    agent: "plan",
    parts: [{ type: "text", text: "Analyze the architecture of this project" }]
  }
})

// Use a custom agent
await client.session.prompt({
  path: { id: session.data.id },
  body: {
    agent: "code-reviewer",
    parts: [{ type: "text", text: "Review the recent changes for security issues" }]
  }
})
```

---

## MCP Server Management

Configure and manage Model Context Protocol servers for extended tool capabilities.

```typescript
import { createOpencodeClient } from "@opencode-ai/sdk"

const client = createOpencodeClient({ baseUrl: "http://localhost:4096" })

// Get MCP server status
const mcpStatus = await client.mcp.status()
for (const [name, status] of Object.entries(mcpStatus.data)) {
  console.log(`${name}: ${status.status}`)
  if (status.status === "failed") {
    console.log(`  Error: ${status.error}`)
  }
}

// Add a local MCP server
await client.mcp.add({
  body: {
    name: "filesystem",
    config: {
      type: "local",
      command: ["npx", "-y", "@modelcontextprotocol/server-filesystem", "/home/user/projects"],
      enabled: true,
      timeout: 5000
    }
  }
})

// Add a remote MCP server with OAuth
await client.mcp.add({
  body: {
    name: "github-mcp",
    config: {
      type: "remote",
      url: "https://mcp.github.com",
      enabled: true,
      oauth: {
        clientId: "your-client-id",
        scope: "repo user"
      }
    }
  }
})

// Connect/disconnect MCP servers
await client.mcp.connect({ path: { name: "filesystem" } })
await client.mcp.disconnect({ path: { name: "filesystem" } })

// Start OAuth flow for MCP server
const authResult = await client.mcp.auth.start({ path: { name: "github-mcp" } })
console.log("Open this URL to authenticate:", authResult.data.authorizationUrl)

// Complete OAuth after user authorization
await client.mcp.auth.callback({
  path: { name: "github-mcp" },
  body: { code: "auth_code_from_callback" }
})
```

---

## TUI Control

Control the Terminal User Interface programmatically through the server API.

```typescript
import { createOpencodeClient } from "@opencode-ai/sdk"

const client = createOpencodeClient({ baseUrl: "http://localhost:4096" })

// Append text to the current prompt
await client.tui.appendPrompt({
  body: { text: "Implement error handling for the API" }
})

// Submit the current prompt
await client.tui.submitPrompt()

// Clear the prompt
await client.tui.clearPrompt()

// Show a toast notification
await client.tui.showToast({
  body: {
    title: "Build Complete",
    message: "All tests passed successfully",
    variant: "success", // "info" | "success" | "warning" | "error"
    duration: 5000
  }
})

// Open various dialogs
await client.tui.openHelp()
await client.tui.openSessions()
await client.tui.openModels()
await client.tui.openThemes()

// Execute a TUI command
await client.tui.executeCommand({
  body: { command: "session.new" }
})
```

---

## CLI Commands

Run OpenCode from the command line for scripting and automation.

```bash
# Start the TUI interface
opencode

# Continue last session
opencode --continue

# Use a specific model
opencode --model anthropic/claude-sonnet-4-20250514

# Run a single prompt (non-interactive)
opencode run "Explain how closures work in JavaScript"

# Run with a specific agent
opencode run --agent plan "Analyze the project structure"

# Attach file to prompt
opencode run --file src/auth.ts "Review this code for security issues"

# Continue from last session
opencode run --continue "Now add unit tests"

# Output as JSON events
opencode run --format json "List all API endpoints"

# Start headless server
opencode serve --port 4096 --hostname 0.0.0.0

# Start with web interface
opencode web --port 4096

# Attach TUI to running server
opencode attach http://localhost:4096

# List available models
opencode models
opencode models anthropic --verbose

# Manage authentication
opencode auth login
opencode auth list
opencode auth logout

# Session management
opencode session list --format json
opencode export <sessionID>
opencode import session.json

# Statistics and usage
opencode stats --days 30 --models 5
```

---

## Configuration File

Configure OpenCode using `opencode.json` in your project root or `~/.config/opencode/opencode.json` globally.

```jsonc
{
  "$schema": "https://opencode.ai/config.json",

  // Default model for all agents
  "model": "anthropic/claude-sonnet-4-20250514",
  "small_model": "anthropic/claude-haiku-4-20250514",

  // Theme
  "theme": "opencode",

  // Auto-update settings
  "autoupdate": true,

  // TUI settings
  "tui": {
    "scroll_speed": 3,
    "scroll_acceleration": { "enabled": true },
    "diff_style": "auto"
  },

  // Server settings
  "server": {
    "port": 4096,
    "hostname": "127.0.0.1",
    "cors": ["http://localhost:5173"]
  },

  // Tool access
  "tools": {
    "write": true,
    "edit": true,
    "bash": true
  },

  // Permissions
  "permission": {
    "edit": "allow",
    "bash": "ask",
    "webfetch": "ask"
  },

  // Custom agents
  "agent": {
    "code-reviewer": {
      "description": "Reviews code for best practices",
      "mode": "subagent",
      "model": "anthropic/claude-sonnet-4-20250514",
      "tools": { "write": false, "edit": false },
      "permission": { "bash": "deny" }
    }
  },

  // Custom commands
  "command": {
    "test": {
      "template": "Run tests and show failures",
      "description": "Run test suite",
      "agent": "build"
    }
  },

  // Provider configuration
  "provider": {
    "anthropic": {
      "options": {
        "timeout": 600000
      }
    }
  },

  // MCP servers
  "mcp": {
    "filesystem": {
      "type": "local",
      "command": ["npx", "-y", "@modelcontextprotocol/server-filesystem", "."],
      "enabled": true
    }
  },

  // Additional instruction files
  "instructions": ["CONTRIBUTING.md", "docs/guidelines.md"]
}
```

---

## Creating Custom Agents via Markdown

Define agents using markdown files in `.opencode/agents/` (project) or `~/.config/opencode/agents/` (global).

```markdown
---
description: Reviews code for security vulnerabilities
mode: subagent
model: anthropic/claude-sonnet-4-20250514
temperature: 0.1
tools:
  write: false
  edit: false
  bash: false
permission:
  bash: deny
  webfetch: deny
---

You are a security auditor. Focus on identifying potential security issues:

- Input validation vulnerabilities
- Authentication and authorization flaws
- Data exposure risks
- Dependency vulnerabilities
- Configuration security issues

Provide detailed findings with severity levels and remediation suggestions.
Do not modify any code - only analyze and report.
```

---

## HTTP API Examples

Direct HTTP requests to the OpenCode server for custom integrations.

```bash
# List sessions
curl http://localhost:4096/session

# Create a new session
curl -X POST http://localhost:4096/session \
  -H "Content-Type: application/json" \
  -d '{"title": "API Test Session"}'

# Send a prompt
curl -X POST http://localhost:4096/session/{sessionId}/message \
  -H "Content-Type: application/json" \
  -d '{
    "model": {"providerID": "anthropic", "modelID": "claude-sonnet-4-20250514"},
    "parts": [{"type": "text", "text": "Hello, analyze this codebase"}]
  }'

# Get session messages
curl http://localhost:4096/session/{sessionId}/message

# Search for text in files
curl "http://localhost:4096/find?pattern=function.*test"

# Find files by name
curl "http://localhost:4096/find/file?query=*.ts&type=file&limit=50"

# Read file content
curl "http://localhost:4096/file/content?path=src/index.ts"

# Get MCP server status
curl http://localhost:4096/mcp

# Subscribe to events (SSE)
curl -N http://localhost:4096/event

# Get available agents
curl http://localhost:4096/agent

# Get OpenAPI specification
curl http://localhost:4096/doc
```

---

## Summary

OpenCode provides a comprehensive platform for AI-assisted software development, supporting both interactive terminal usage and programmatic integration through its SDK and HTTP API. The primary use cases include automated code generation and refactoring, code review and security analysis, documentation generation, codebase exploration and understanding, and building custom development workflows. The SDK enables seamless integration into existing tools, CI/CD pipelines, and custom applications.

Integration patterns typically involve either running OpenCode as a standalone server (`opencode serve`) and connecting via the SDK or HTTP API, or using the `createOpencode()` function to spin up both server and client programmatically. The event subscription system enables real-time monitoring of sessions, while the agent system allows for specialized AI assistants with controlled tool access and permissions. Custom agents can be defined in JSON configuration or markdown files, making it easy to create purpose-built assistants for specific development tasks.
