# .envrc - Sources secrets from ~/.secrets/com.trends.app.env
# Auto-loaded by direnv on cd into project
#
# Setup:
#   1. Install direnv: https://direnv.net/docs/installation.html
#   2. Create secrets file:
#      mkdir -p ~/.secrets && chmod 700 ~/.secrets
#      cp .env.example ~/.secrets/com.trends.app.env
#      chmod 600 ~/.secrets/com.trends.app.env
#   3. Edit ~/.secrets/com.trends.app.env with your secrets
#   4. Allow direnv: direnv allow
#
# The secrets file is stored outside the repo for security.

# Clean slate - reset env vars on each cd to avoid stale values
unset AI_API_KEY AI_MODEL AI_API_BASE AI_ANALYSIS_ENABLED
unset TELEGRAM_BOT_TOKEN TELEGRAM_CHAT_ID
unset FEISHU_WEBHOOK_URL
unset DINGTALK_WEBHOOK_URL DINGTALK_SECRET
unset WEWORK_WEBHOOK_URL
unset EMAIL_HOST EMAIL_PORT EMAIL_USER EMAIL_PASSWORD EMAIL_FROM EMAIL_TO
unset SLACK_WEBHOOK_URL
unset BARK_URL
unset NTFY_URL NTFY_TOPIC
unset GENERIC_WEBHOOK_URL GENERIC_WEBHOOK_METHOD
unset S3_ENDPOINT_URL S3_ACCESS_KEY_ID S3_SECRET_ACCESS_KEY S3_BUCKET_NAME S3_REGION

# Load secrets from secure location
SECRETS_FILE="$HOME/.secrets/com.trends.app.env"

if [[ -f "$SECRETS_FILE" ]]; then
    dotenv "$SECRETS_FILE"
else
    echo "Warning: Secrets file not found at $SECRETS_FILE"
    echo "Create it with: cp .env.example ~/.secrets/com.trends.app.env"
    echo "Then edit with your secrets and run: direnv allow"
fi

# Optional: Load local .env if it exists (for development overrides)
if [[ -f ".env" ]]; then
    dotenv ".env"
fi

# Set development defaults if not already set
export DEBUG="${DEBUG:-true}"
export TIMEZONE="${TIMEZONE:-Asia/Shanghai}"
